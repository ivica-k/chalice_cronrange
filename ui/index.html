<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/png" href="img/favicon.png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Cron range allows you to easily predict your cron runs.">
    <meta name="keywords" content="cron range, easily predict your cron runs, regex, regex range, cron executions, cron trigger, cron job, cron job runs, cron job executions, cron run">
    <meta name="author" content="Ivica Kolenkaš & Marija Kolenkaš">
    <link href="https://fonts.googleapis.com/css?family=Chivo:300,300i,400,400i,700,700i,900,900i" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.3/daterangepicker.min.css" />
    <title>Cron range - easily predict your cron runs</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous" />
    <link href="css/style.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="logo" href="/">[CR-ON] <span class="logo-orange">Range</span></a>
      </nav>
    </header>    
    <main role="main" class="container-fluid">
      <div class="row">
        <div class="col-xl-4 offset-xl-4 col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-sm-12 col-12 flex">
          <form class="form">
            <div class="form-group">
              <label><h1><span> -- </span>Starting date time<span> -- </span></h1></label>
              <div class="input-group date">
                <input class="form-control" type="text" id="dtpicker" />
              </div>
            </div>
            <div class="form-group">
              <label><h1><span> -- </span>Cron expression<span> -- </span></h1></label>
              <div class="input-group">
                <input class="form-control" type="text" id="cron_expression" maxlength="15" placeholder="*/5 * * * *" autofocus="true" required=""/>
              </div>
            </div>
            <div class="form-group">
              <label><h1><span> -- </span>Executions to show<span> -- </span></h1></label>
              <input class="form-control" type="number" id="iterations" min="1" max="100" step="1" value="10" name="quantity" />
            </div>
            <div class="form-group buttons">
              <button type="button" class="btn btn-results" id="btn" data-toggle="modal" data-target="#exampleModalLong">Show results</button>
            </div>
          </form>
        </div>
    </div>
    <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Next executions</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body"><p id="result"></p></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-copy" id="btn-copy" onclick="copy('#result')"
                            data-container="body" data-toggle="popover" data-placement="top" data-content="Copied!">Copy
                        results
                    </button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</main>


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.3/daterangepicker.min.js"></script>
<script type="text/javascript">
    $(document).on('keyup', 'input[name=quantity]', function () {

        var _this = $(this);
        var min = parseInt(_this.attr('min')) || 1;
        var max = parseInt(_this.attr('max')) || 100;
        var val = parseInt(_this.val()) || min - 1;
        if (val < min) _this.val(min);
        if (val > max) _this.val(max);
    });

    function copy(selector) {
        var $temp = $('<div>');
        $('body').append($temp);
        $temp
            .attr('contenteditable', true)
            .html($(selector).html())
            .select()
            .on('focus', function () {
                document.execCommand('selectAll', false, null);
            })
            .focus();
        document.execCommand('copy');
        $temp.remove();
    }

    function chunkArray(myArray, chunk_size) {
        var index = 0;
        var arrayLength = myArray.length;
        var tempArray = [];
        for (index = 0; index < arrayLength; index += chunk_size) {
            myChunk = myArray.slice(index, index + chunk_size);
            tempArray.push(myChunk);
        }
        return tempArray;
    }

    $(document).ready(function () {
        $(function () {
            $('#dtpicker').daterangepicker({
                singleDatePicker: true,
                showDropdowns: true,
                timePicker: true,
                timePicker24Hour: true,
                startDate: moment().startOf('minute'),
                endDate: moment()
                    .startOf('hour')
                    .add(32, 'hour'),
                locale: {
                    format: 'DD.MM.YYYY. HH:mm'
                }
            });
        });
      });

      $(function() {
        $('#btn').click(function() {
          if($('#cron_expression').val()== ""){
            $('#cron_expression').addClass("invalid");
            return false;
          }
          else{
            json_data = {};
            $('#result').text('');
            json_data.datetime = $('#dtpicker').val();
            json_data.cron = $('#cron_expression').val();
            json_data.executions = $('#iterations').val();
            $.ajax('http://localhost:8000/', {
              data: JSON.stringify(json_data),
              contentType: 'application/json',
              type: 'POST',
              dataType: 'JSON',
              success: function(data) {
                var columns = chunkArray(data.cron_ranges, 25);
                $.each(columns, function(index, column) {
                  lis = '<ol>';
                  $.each(column, function(index, element) {
                    lis += '<li>' + element + '</li>';
                  });
                  lis += '</ol>';
                  $('#result').append(lis);
                });
              }
            });
          }        

        });
    });
</script>
</body>
</html>
